import numpy as np
from smt.surrogate_models import RMTB
import matplotlib.pyplot as plt
plt.rcParams["font.family"] = "Times New Roman"
plt.rcParams.update({'font.size': 12})

d = 30
qvec = np.zeros((d*d))
rvec = np.zeros((d*d))

rpm_space = np.linspace(0,6000,d)
torque_space = np.linspace(0,2500,d)
i = 0
for rpm in rpm_space:
    for q in torque_space:
        rvec[i] = 1*rpm
        qvec[i] = 1*q
        i += 1

xtq = 1*qvec
xtr = 1*rvec
xt = np.transpose(np.array([xtr, xtq]))
# print(np.shape(xt))

yt = np.array(
[4.24586348e-06,4.07002272e-05,7.71519065e-05,1.13600902e-04,
 1.50047213e-04,1.86490842e-04,2.22931787e-04,2.59370049e-04,
 2.95805628e-04,3.32238526e-04,3.68668741e-04,4.05096275e-04,
 4.41521127e-04,4.77943298e-04,5.14362789e-04,5.50779599e-04,
 5.87193729e-04,6.23605179e-04,6.60013949e-04,6.96420040e-04,
 7.32823452e-04,7.69224185e-04,8.05622240e-04,8.42017617e-04,
 8.78410316e-04,9.14800338e-04,9.51187682e-04,9.87572349e-04,
 1.02395434e-03,1.06033365e-03,6.05113383e-01,8.99129090e-01,
 8.99273626e-01,8.82087142e-01,8.60687443e-01,8.38383813e-01,
 8.16443275e-01,7.95418422e-01,7.75541461e-01,7.56884533e-01,
 7.39437187e-01,7.23147151e-01,7.07942617e-01,6.93744553e-01,
 6.80473456e-01,6.68052927e-01,6.56411435e-01,6.45483039e-01,
 6.35207523e-01,6.25530219e-01,6.16401660e-01,6.07777162e-01,
 5.99616390e-01,5.91882930e-01,5.84543884e-01,5.77569509e-01,
 5.70932871e-01,5.64609553e-01,5.58577379e-01,5.52816181e-01,
 7.08866748e-01,9.33318482e-01,9.35415809e-01,9.26510098e-01,
 9.15124054e-01,9.03280601e-01,8.91695474e-01,8.80651499e-01,
 8.70251025e-01,8.60513277e-01,8.51418294e-01,8.42928428e-01,
 8.34999269e-01,8.27585229e-01,8.20642329e-01,8.14129503e-01,
 8.08009095e-01,8.02246937e-01,7.96812211e-01,7.91677204e-01,
 7.86817033e-01,7.82209356e-01,7.77834103e-01,7.73673224e-01,
 7.69710458e-01,7.65931134e-01,7.62321993e-01,7.58871024e-01,
 7.55567327e-01,7.52400991e-01,7.63178953e-01,9.47912645e-01,
 9.50455398e-01,9.44645951e-01,9.36977988e-01,9.28956057e-01,
 9.21098804e-01,9.13605947e-01,9.06547777e-01,8.99936538e-01,
 8.93757804e-01,8.87985460e-01,8.82589129e-01,8.77537891e-01,
 8.72802090e-01,8.68354146e-01,8.64168851e-01,8.60223384e-01,
 8.56497192e-01,8.52971823e-01,8.49630717e-01,8.46459016e-01,
 8.43443379e-01,8.40571804e-01,8.37833484e-01,8.35218664e-01,
 8.32718525e-01,8.30325076e-01,8.28031061e-01,8.25829882e-01,
 7.95822580e-01,9.55888961e-01,9.58640207e-01,9.54471126e-01,
 9.48758710e-01,9.42732842e-01,9.36812616e-01,9.31158328e-01,
 9.25826704e-01,9.20828557e-01,9.16153791e-01,9.11783182e-01,
 9.07694162e-01,9.03863691e-01,9.00269650e-01,8.96891459e-01,
 8.93710305e-01,8.90709152e-01,8.87872658e-01,8.85187045e-01,
 8.82639948e-01,8.80220268e-01,8.77918035e-01,8.75724281e-01,
 8.73630926e-01,8.71630674e-01,8.69716925e-01,8.67883699e-01,
 8.66125564e-01,8.64437573e-01,8.17051547e-01,9.60835554e-01,
 9.63743909e-01,9.60605325e-01,9.56107482e-01,9.51314052e-01,
 9.46585452e-01,9.42059642e-01,9.37786305e-01,9.33776223e-01,
 9.30022483e-01,9.26510406e-01,9.23222396e-01,9.20140340e-01,
 9.17246776e-01,9.14525419e-01,9.11961358e-01,9.09541076e-01,
 9.07252389e-01,9.05084348e-01,9.03027119e-01,9.01071874e-01,
 8.99210675e-01,8.97436381e-01,8.95742554e-01,8.94123379e-01,
 8.92573593e-01,8.91088426e-01,8.89663542e-01,8.88294995e-01,
 8.31536431e-01,9.64143410e-01,9.67199093e-01,9.64778315e-01,
 9.61113773e-01,9.57160680e-01,9.53241839e-01,9.49481336e-01,
 9.45924857e-01,9.42583636e-01,9.39453207e-01,9.36522142e-01,
 9.33776308e-01,9.31200983e-01,9.28781883e-01,9.26505639e-01,
 9.24359978e-01,9.22333755e-01,9.20416914e-01,9.18600404e-01,
 9.16876093e-01,9.15236672e-01,9.13675568e-01,9.12186864e-01,
 9.10765219e-01,9.09405812e-01,9.08104276e-01,9.06856648e-01,
 9.05659330e-01,9.04509041e-01,8.41709849e-01,9.66465023e-01,
 9.69669268e-01,9.67784754e-01,9.64731496e-01,9.61390673e-01,
 9.58059756e-01,9.54853781e-01,9.51816100e-01,9.48958602e-01,
 9.46278787e-01,9.43767697e-01,9.41413773e-01,9.39204784e-01,
 9.37128766e-01,9.35174466e-01,9.33331523e-01,9.31590505e-01,
 9.29942888e-01,9.28380990e-01,9.26897902e-01,9.25487409e-01,
 9.24143918e-01,9.22862388e-01,9.21638270e-01,9.20467454e-01,
 9.19346215e-01,9.18271174e-01,9.17239256e-01,9.16247662e-01,
 8.48963558e-01,9.68147099e-01,9.71503958e-01,9.70040989e-01,
 9.67458386e-01,9.64585461e-01,9.61702159e-01,9.58917469e-01,
 9.56273418e-01,9.53782649e-01,9.51444303e-01,9.49251384e-01,
 9.47194340e-01,9.45262859e-01,9.43446754e-01,9.41736388e-01,
 9.40122849e-01,9.38598009e-01,9.37154502e-01,9.35785684e-01,
 9.34485568e-01,9.33248765e-01,9.32070422e-01,9.30946160e-01,
 9.29872028e-01,9.28844449e-01,9.27860184e-01,9.26916292e-01,
 9.26010097e-01,9.25139160e-01,8.54151347e-01,9.69390916e-01,
 9.72904806e-01,9.71786277e-01,9.69579631e-01,9.67077428e-01,
 9.64547350e-01,9.62094342e-01,9.59759765e-01,9.57557064e-01,
 9.55486796e-01,9.53543577e-01,9.51719479e-01,9.50005724e-01,
 9.48393537e-01,9.46874558e-01,9.45441024e-01,9.44085827e-01,
 9.42802516e-01,9.41585257e-01,9.40428790e-01,9.39328373e-01,
 9.38279729e-01,9.37279001e-01,9.36322702e-01,9.35407677e-01,
 9.34531063e-01,9.33690263e-01,9.32882912e-01,9.32106852e-01,
 8.57826031e-01,9.70321342e-01,9.73996308e-01,9.73167903e-01,
 9.71270405e-01,9.69070388e-01,9.66826987e-01,9.64642508e-01,
 9.62558099e-01,9.60588033e-01,9.58734114e-01,9.56992329e-01,
 9.55356096e-01,9.53817904e-01,9.52370131e-01,9.51005457e-01,
 9.49717052e-01,9.48498636e-01,9.47344495e-01,9.46249454e-01,
 9.45208835e-01,9.44218420e-01,9.43274398e-01,9.42373330e-01,
 9.41512104e-01,9.40687902e-01,9.39898168e-01,9.39140578e-01,
 9.38413018e-01,9.37713558e-01,8.60361302e-01,9.71019950e-01,
 9.74859489e-01,9.74281506e-01,9.72644258e-01,9.70696279e-01,
 9.68690880e-01,9.66728746e-01,9.64851136e-01,9.63073168e-01,
 9.61397770e-01,9.59822114e-01,9.58340768e-01,9.56947284e-01,
 9.55635010e-01,9.54397494e-01,9.53228677e-01,9.52122969e-01,
 9.51075266e-01,9.50080937e-01,9.49135786e-01,9.48236026e-01,
 9.47378231e-01,9.46559305e-01,9.45776447e-01,9.45027116e-01,
 9.44309008e-01,9.43620025e-01,9.42958259e-01,9.42321966e-01,
 8.62018814e-01,9.71542288e-01,9.75549356e-01,9.75191890e-01,
 9.73778031e-01,9.72044290e-01,9.70240212e-01,9.68465626e-01,
 9.66762141e-01,9.65145730e-01,9.63620349e-01,9.62184219e-01,
 9.60832903e-01,9.59560871e-01,9.58362295e-01,9.57231462e-01,
 9.56162968e-01,9.55151806e-01,9.54193387e-01,9.53283535e-01,
 9.52418465e-01,9.51594749e-01,9.50809286e-01,9.50059269e-01,
 9.49342156e-01,9.48655639e-01,9.47997625e-01,9.47366208e-01,
 9.46753174e-01,9.46049478e-01,8.62987215e-01,9.71927491e-01,
 9.76104565e-01,9.75944527e-01,9.74725577e-01,9.73176876e-01,
 9.71545790e-01,9.69931881e-01,9.68377292e-01,9.66898856e-01,
 9.65501481e-01,9.64184329e-01,9.62943845e-01,9.61775296e-01,
 9.60673574e-01,9.59633602e-01,9.58650541e-01,9.57719883e-01,
 9.56837482e-01,9.55999555e-01,9.55202662e-01,9.54443687e-01,
 9.53719804e-01,9.53028453e-01,9.52367311e-01,9.51712502e-01,
 9.50943109e-01,9.50036440e-01,9.48981043e-01,9.47758830e-01,
 8.63405933e-01,9.72203926e-01,9.76553076e-01,9.76572268e-01,
 9.75525766e-01,9.74139080e-01,9.72658652e-01,9.71184237e-01,
 9.69758657e-01,9.68399605e-01,9.67112884e-01,9.65898511e-01,
 9.64753720e-01,9.63674486e-01,9.62656331e-01,9.61694738e-01,
 9.60785362e-01,9.59924129e-01,9.59107278e-01,9.58331365e-01,
 9.57593254e-01,9.56890094e-01,9.56215481e-01,9.55451774e-01,
 9.54547198e-01,9.53491367e-01,9.52267207e-01,9.50847091e-01,
 9.49186598e-01,9.47211446e-01,8.63380221e-01,9.72392659e-01,
 9.76915616e-01,9.77099434e-01,9.76207351e-01,9.74964204e-01,
 9.73616515e-01,9.72264599e-01,9.70952073e-01,9.69697491e-01,
 9.68507502e-01,9.67382912e-01,9.66321664e-01,9.65320374e-01,
 9.64375123e-01,9.63481891e-01,9.62636767e-01,9.61836062e-01,
 9.61076354e-01,9.60354496e-01,9.59642272e-01,9.58805010e-01,
 9.57818980e-01,9.56672137e-01,9.55343204e-01,9.53796970e-01,
 9.51974832e-01,9.49773251e-01,9.46984831e-01,9.43070773e-01,
 8.62991008e-01,9.72509658e-01,9.77207871e-01,9.77544418e-01,
 9.76792066e-01,9.75677403e-01,9.74447854e-01,9.73204596e-01,
 9.71992129e-01,9.70829869e-01,9.69725273e-01,9.68679876e-01,
 9.67692277e-01,9.66759665e-01,9.65878629e-01,9.65045592e-01,
 9.64257034e-01,9.63509605e-01,9.62774112e-01,9.61910164e-01,
 9.60893639e-01,9.59712668e-01,9.58344971e-01,9.56752589e-01,
 9.54870770e-01,9.52581612e-01,9.49637098e-01,9.45318691e-01,
 9.32789791e-01,9.34647832e-01,8.62301529e-01,9.72567251e-01,
 9.77441935e-01,9.77921388e-01,9.77296637e-01,9.76298033e-01,
 9.75174575e-01,9.74028550e-01,9.72905416e-01,9.71825453e-01,
 9.70796889e-01,9.69821947e-01,9.68899827e-01,9.68028244e-01,
 9.67204250e-01,9.66424667e-01,9.65679106e-01,9.64830072e-01,
 9.63827413e-01,9.62661858e-01,9.61313769e-01,9.59748104e-01,
 9.57904147e-01,9.55671117e-01,9.52817913e-01,9.48693588e-01,
 9.36101123e-01,9.37987646e-01,9.39746800e-01,9.41391063e-01,
 8.61361895e-01,9.72575105e-01,9.77627281e-01,9.78241434e-01,
 9.77734152e-01,9.76841229e-01,9.75813801e-01,9.74755469e-01,
 9.73712714e-01,9.72706676e-01,9.71746330e-01,9.70834545e-01,
 9.69971082e-01,9.69154141e-01,9.68381178e-01,9.67581639e-01,
 9.66629330e-01,9.65517944e-01,9.64233545e-01,9.62748316e-01,
 9.61012830e-01,9.58938057e-01,9.56346919e-01,9.52797439e-01,
 9.46038690e-01,9.40427263e-01,9.42237255e-01,9.43919976e-01,
 9.45488393e-01,9.46953772e-01,8.60212321e-01,9.72540908e-01,
 9.77771435e-01,9.78513359e-01,9.78114997e-01,9.77318997e-01,
 9.76379111e-01,9.75400426e-01,9.74430494e-01,9.73491320e-01,
 9.72592600e-01,9.71737816e-01,9.70927253e-01,9.70155016e-01,
 9.69283776e-01,9.68255534e-01,9.67064182e-01,9.65691508e-01,
 9.64102158e-01,9.62232457e-01,9.59962504e-01,9.57031045e-01,
 9.52625744e-01,9.42076713e-01,9.43975216e-01,9.45729317e-01,
 9.47354889e-01,9.48865558e-01,9.50273091e-01,9.51587703e-01,
 8.58885439e-01,9.72470852e-01,9.77880450e-01,9.78744243e-01,
 9.78447518e-01,9.77740985e-01,9.76881413e-01,9.75975524e-01,
 9.75071985e-01,9.74193664e-01,9.73350956e-01,9.72547930e-01,
 9.71761805e-01,9.70841238e-01,9.69762489e-01,9.68518451e-01,
 9.67087928e-01,9.65429792e-01,9.63468629e-01,9.61056756e-01,
 9.57845191e-01,9.52446343e-01,9.45025421e-01,9.46890175e-01,
 9.48606765e-01,9.50192173e-01,9.51660885e-01,9.53025326e-01,
 9.54296221e-01,9.55482871e-01,8.57408001e-01,9.72369977e-01,
 9.77959252e-01,9.78939842e-01,9.78738500e-01,9.78115032e-01,
 9.77329571e-01,9.76490596e-01,9.75647931e-01,9.74825301e-01,
 9.74033788e-01,9.73236521e-01,9.72288738e-01,9.71182613e-01,
 9.69911127e-01,9.68451842e-01,9.66760514e-01,9.64754679e-01,
 9.62268446e-01,9.58887279e-01,9.52546473e-01,9.47431943e-01,
 9.49281609e-01,9.50977569e-01,9.52538217e-01,9.53979126e-01,
 9.55313566e-01,9.56552919e-01,9.57706997e-01,9.58784309e-01,
 8.55802135e-01,9.72242429e-01,9.78011890e-01,9.79104885e-01,
 9.78993516e-01,9.78447574e-01,9.77730859e-01,9.76953713e-01,
 9.76167147e-01,9.75395746e-01,9.74600086e-01,9.73645735e-01,
 9.72533096e-01,9.71256826e-01,9.69795199e-01,9.68103905e-01,
 9.66099247e-01,9.63610862e-01,9.60204171e-01,9.53483416e-01,
 9.49379884e-01,9.51232499e-01,9.52923872e-01,9.54474176e-01,
 9.55900352e-01,9.57216735e-01,9.58435533e-01,9.59567209e-01,
 9.60620783e-01,9.61604070e-01,8.54086295e-01,9.72091651e-01,
 9.78041721e-01,9.79243292e-01,9.79217182e-01,9.78743946e-01,
 9.78091304e-01,9.77371560e-01,9.76636936e-01,9.75861490e-01,
 9.74920509e-01,9.73820352e-01,9.72559210e-01,9.71118059e-01,
 9.69455432e-01,9.67491925e-01,9.65066212e-01,9.61772704e-01,
 9.55562428e-01,9.50931770e-01,9.52805456e-01,9.54508060e-01,
 9.56061989e-01,9.57485903e-01,9.58795465e-01,9.60003917e-01,
 9.61122534e-01,9.62160974e-01,9.63127560e-01,9.64029499e-01,
 8.52275991e-01,9.71920522e-01,9.78051555e-01,9.79358343e-01,
 9.79413362e-01,9.79008606e-01,9.78415944e-01,9.77749722e-01,
 9.77019022e-01,9.76112492e-01,9.75042976e-01,9.73814552e-01,
 9.72412903e-01,9.70801861e-01,9.68910510e-01,9.66596193e-01,
 9.63514395e-01,9.58218904e-01,9.52133599e-01,9.54047290e-01,
 9.55777315e-01,9.57348905e-01,9.58782870e-01,9.60096530e-01,
 9.61304416e-01,9.62418808e-01,9.63450156e-01,9.64407410e-01,
 9.65298278e-01,9.66129434e-01,8.50384339e-01,9.71731473e-01,
 9.78043758e-01,9.79452800e-01,9.79585306e-01,9.79245307e-01,
 9.78709020e-01,9.78059089e-01,9.77212739e-01,9.76193204e-01,
 9.75013992e-01,9.73667778e-01,9.72125722e-01,9.70328005e-01,
 9.68155280e-01,9.65334013e-01,9.60916936e-01,9.53017756e-01,
 9.54992006e-01,9.56766659e-01,9.58370529e-01,9.59827136e-01,
 9.61155872e-01,9.62372868e-01,9.63491649e-01,9.64523644e-01,
 9.65478573e-01,9.66364760e-01,9.67189368e-01,9.67958601e-01,
 8.48422510e-01,9.71526565e-01,9.78020340e-01,9.79529006e-01,
 9.79735774e-01,9.79457235e-01,9.78950756e-01,9.78201872e-01,
 9.77256617e-01,9.76144327e-01,9.74868028e-01,9.73408231e-01,
 9.71717644e-01,9.69700941e-01,9.67150405e-01,9.63457400e-01,
 9.53604899e-01,9.55662849e-01,9.57501087e-01,9.59153017e-01,
 9.60645596e-01,9.62000820e-01,9.63236816e-01,9.64368655e-01,
 9.65408970e-01,9.66368431e-01,9.67256112e-01,9.68079777e-01,
 9.68846110e-01,9.69560896e-01,8.46400064e-01,9.71307563e-01,
 9.77983019e-01,9.79588964e-01,9.79867122e-01,9.79631265e-01,
 9.79043679e-01,9.78209313e-01,9.77187038e-01,9.75996453e-01,
 9.74630416e-01,9.73055282e-01,9.71198423e-01,9.68906737e-01,
 9.65787700e-01,9.59765229e-01,9.56073477e-01,9.57996907e-01,
 9.59714512e-01,9.61257653e-01,9.62651627e-01,9.63917065e-01,
 9.65070961e-01,9.66127441e-01,9.67098342e-01,9.67993657e-01,
 9.68821882e-01,9.69590286e-01,9.70305124e-01,9.70971808e-01,
 8.44325232e-01,9.71075983e-01,9.77933269e-01,9.79634395e-01,
 9.79968233e-01,9.79669324e-01,9.79010611e-01,9.78114739e-01,
 9.77031642e-01,9.75772499e-01,9.74319440e-01,9.72621030e-01,
 9.70567430e-01,9.67902664e-01,9.63745261e-01,9.56228435e-01,
 9.58262471e-01,9.60066046e-01,9.61676228e-01,9.63122539e-01,
 9.64428785e-01,9.65614373e-01,9.66695281e-01,9.67684788e-01,
 9.68594017e-01,9.69432356e-01,9.70207785e-01,9.70927128e-01,
 9.71596260e-01,9.72220258e-01,8.42205131e-01,9.70833136e-01,
 9.77872363e-01,9.79647572e-01,9.79937103e-01,9.79585911e-01,
 9.78882978e-01,9.77943667e-01,9.76811399e-01,9.75489498e-01,
 9.73947811e-01,9.72111086e-01,9.69811201e-01,9.66584962e-01,
 9.58108768e-01,9.58298281e-01,9.60211901e-01,9.61908288e-01,
 9.63422445e-01,9.64782238e-01,9.66010129e-01,9.67124421e-01,
 9.68140183e-01,9.69069928e-01,9.69924141e-01,9.70711665e-01,
 9.71440017e-01,9.72115624e-01,9.72744016e-01,9.73329975e-01])


xlimits = np.array([[rpm_space.min(), rpm_space.max()], [torque_space.min(), torque_space.max()]])


sm_eta = RMTB(
            xlimits=xlimits,
            order=3,
            num_ctrl_pts=30,
            energy_weight=1e-10,
            regularization_weight=0.0,
            print_global=False,
            print_solver=False,)


# train model
sm_eta.set_training_values(xt, yt)
sm_eta.train()




if __name__ == '__main__':
    # interpolate surrogate model and plot it
    num = 100
    x = np.linspace(0,6000,num)
    y = np.linspace(0,2400,num)
    X, Y = np.meshgrid(x, y)

    xint = np.zeros((num*num,2))
    index = 0
    for i in range(num):
        for j in range(num):
            xint[index,:] = [x[i],y[j]]
            index += 1

    zint_eta = sm_eta.predict_values(xint)
    ZN = np.zeros((num,num))
    index = 0
    for i in range(num):
        for j in range(num):
            ZN[j,i] = zint_eta[index]
            index += 1
            
    plt.rcParams['figure.figsize'] = [6, 3]
    levels = np.arange(0.0, 1.05, 0.03)
    plot = plt.contourf(X, Y, ZN, cmap='jet', levels=levels)
    plt.contour(X,Y,ZN,colors='k',levels=levels,linewidths=0.5,alpha=0.5)
    plt.colorbar(plot, shrink=1)
    plt.xlabel('motor speed (rpm)')
    plt.ylabel('load torque (N-m)')
    
    plt.savefig('motor_model.png', dpi=1200, bbox_inches='tight')
    
    plt.show()





























